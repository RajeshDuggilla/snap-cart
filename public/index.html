<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SnapCart Frontend</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      background-color: #f5f5f5;
    }
    h2, h3 {
      color: #333;
    }
    form, button {
      margin-bottom: 1rem;
    }
    input, select, button {
      padding: 0.5rem;
      margin: 0.25rem;
    }
    ul {
      padding-left: 1rem;
    }
    .admin-only {
      border: 1px dashed #d33;
      padding: 1rem;
      background-color: #ffe5e5;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background-color: #fff;
      padding: 2rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .token-box {
      background: #eee;
      padding: 1rem;
      font-family: monospace;
      overflow-wrap: break-word;
    }
    #output {
      margin-top: 1rem;
      padding: 1rem;
      background: #e3f6ff;
      color: #333;
      font-family: monospace;
    }
    #loader {
      display: none;
      margin-top: 1rem;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    .pagination button {
      padding: 0.5rem 1rem;
      margin: 0.25rem;
      border: none;
      background-color: #007bff;
      color: #fff;
      border-radius: 4px;
      cursor: pointer;
    }
    .pagination button.active {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>üõí SnapCart</h2>

  <div id="authSection">
    <h3>Register</h3>
    <form id="registerForm">
      <input placeholder="Name" name="name" required />
      <input placeholder="Email" name="email" type="email" required />
      <input placeholder="Password" name="password" type="password" required />
      <select name="role">
        <option value="customer">Customer</option>
        <option value="admin">Admin</option>
      </select>
      <button type="submit">Register</button>
    </form>

    <h3>Login</h3>
    <form id="loginForm">
      <input placeholder="Email" name="email" type="email" required />
      <input placeholder="Password" name="password" type="password" required />
      <button type="submit">Login</button>
    </form>
  </div>

  <div id="mainSection" class="hidden">
    <button onclick="logout()">üö™ Logout</button>

    <div class="token-box">
      <p><strong>Token:</strong></p>
      <p id="tokenOutput"></p>
      <p id="roleOutput"></p>
    </div>

    <h3>Products</h3>
    <input type="text" id="searchInput" placeholder="Search by name or category" oninput="searchProducts()" />
    <button onclick="loadProducts()">View All</button>
    <ul id="productList"></ul>
    <div class="pagination" id="paginationControls"></div>

    <div class="admin-only" id="adminSection">
      <h3>Add Product (Admin Only)</h3>
      <form id="addProductForm">
        <input placeholder="Name" name="name" required />
        <input placeholder="Category" name="category" required />
        <input placeholder="Price" name="price" type="number" required />
        <input placeholder="Stock" name="stock" type="number" required />
        <button type="submit">Add Product</button>
      </form>
    </div>

    <h3>Add to Cart</h3>
    <form id="addToCartForm">
      <input placeholder="Product ID" name="product" required />
      <input placeholder="Quantity" name="quantity" type="number" required />
      <button type="submit">Add to Cart</button>
    </form>

    <h3>Your Cart</h3>
    <button onclick="viewCart()">View Cart</button>
    <ul id="cartList"></ul>

    <h3>Place Order</h3>
    <button onclick="placeOrder()">Place Order</button>
  </div>

  <div id="output"></div>
  <div id="loader">‚è≥ Loading...</div>
</div>

<script>
  let currentPage = 1;
  const limit = 5;

  async function loadProducts(page = 1, search = '') {
    currentPage = page;
    try {
      const query = `?page=${page}&limit=${limit}&search=${encodeURIComponent(search)}`;
      const products = await app.http.get(`/api/products${query}`);
      const ul = document.getElementById("productList");
      ul.innerHTML = "";
      (products.data || []).forEach(p => {
        const li = document.createElement("li");
        li.innerText = `${p.name} - ‚Çπ${p.price} - ${p.category} - ID: ${p._id}`;
        ul.appendChild(li);
      });
      renderPagination(products.totalPages);
    } catch (err) {
      showOutput(err.message, false);
    }
  }

  function renderPagination(totalPages) {
    const container = document.getElementById("paginationControls");
    container.innerHTML = "";
    for (let i = 1; i <= totalPages; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      if (i === currentPage) btn.classList.add("active");
      btn.onclick = () => loadProducts(i, document.getElementById("searchInput").value);
      container.appendChild(btn);
    }
  }

  function searchProducts() {
    const searchTerm = document.getElementById("searchInput").value;
    loadProducts(1, searchTerm);
  }
</script>
</body>
</html>


